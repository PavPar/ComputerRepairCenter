--
-- Script was generated by Devart dbForge Studio 2019 for MySQL, Version 8.2.23.0
-- Product home page: http://www.devart.com/dbforge/mysql/studio
-- Script date 11.06.2020 6:17:30
-- Server version: 5.7.25
-- Client version: 4.1
--

-- 
-- Disable foreign keys
-- 
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;

-- 
-- Set SQL mode
-- 
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;

-- 
-- Set character set the client will use to send SQL statements to the server
--
SET NAMES 'utf8';

--
-- Drop table `ticket_pool_states`
--
DROP TABLE IF EXISTS ticket_pool_states;

--
-- Drop table `ticket_history`
--
DROP TABLE IF EXISTS ticket_history;

--
-- Drop table `ticket_state`
--
DROP TABLE IF EXISTS ticket_state;

--
-- Drop table `ticket`
--
DROP TABLE IF EXISTS ticket;

--
-- Drop table `department`
--
DROP TABLE IF EXISTS department;

--
-- Drop table `tech_type`
--
DROP TABLE IF EXISTS tech_type;

--
-- Drop table `ticket_type`
--
DROP TABLE IF EXISTS ticket_type;

--
-- Drop table `master`
--
DROP TABLE IF EXISTS master;

--
-- Drop table `role`
--
DROP TABLE IF EXISTS role;

--
-- Create table `role`
--
CREATE TABLE role (
  role_id BIGINT(20) NOT NULL,
  role_name VARCHAR(255) NOT NULL,
  PRIMARY KEY (role_id)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 8192,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create table `master`
--
CREATE TABLE master (
  master_id BIGINT(20) NOT NULL AUTO_INCREMENT,
  role_id BIGINT(20) NOT NULL DEFAULT 1,
  login VARCHAR(255) NOT NULL,
  password VARCHAR(255) NOT NULL,
  name VARCHAR(50) NOT NULL,
  lastname VARCHAR(255) NOT NULL,
  middleName VARCHAR(255) DEFAULT NULL,
  PRIMARY KEY (master_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 10,
AVG_ROW_LENGTH = 2730,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create index `login` on table `master`
--
ALTER TABLE master 
  ADD UNIQUE INDEX login(login);

--
-- Create foreign key
--
ALTER TABLE master 
  ADD CONSTRAINT FK_master_role_id FOREIGN KEY (role_id)
    REFERENCES role(role_id) ON DELETE NO ACTION;

--
-- Create table `ticket_type`
--
CREATE TABLE ticket_type (
  ticket_type_id BIGINT(20) NOT NULL AUTO_INCREMENT,
  ticket_type_name VARCHAR(255) NOT NULL,
  PRIMARY KEY (ticket_type_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 8,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create table `tech_type`
--
CREATE TABLE tech_type (
  tech_type_id BIGINT(20) NOT NULL AUTO_INCREMENT,
  tech_type_name VARCHAR(255) NOT NULL,
  PRIMARY KEY (tech_type_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 13,
AVG_ROW_LENGTH = 4096,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create table `department`
--
CREATE TABLE department (
  department_id BIGINT(20) NOT NULL AUTO_INCREMENT,
  department_name VARCHAR(255) NOT NULL,
  PRIMARY KEY (department_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 11,
AVG_ROW_LENGTH = 3276,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create table `ticket`
--
CREATE TABLE ticket (
  Ticket_id BIGINT(20) NOT NULL AUTO_INCREMENT,
  Ticket_Date DATETIME NOT NULL,
  Owner VARCHAR(255) NOT NULL,
  Owner_phone VARCHAR(255) NOT NULL,
  Master_id BIGINT(20) DEFAULT NULL,
  Ticket_type_id BIGINT(20) DEFAULT NULL,
  Tech_NameTag VARCHAR(255) DEFAULT NULL,
  Tech_type_id BIGINT(20) DEFAULT NULL,
  Department_id BIGINT(20) DEFAULT NULL,
  Comment VARCHAR(255) DEFAULT NULL,
  PRIMARY KEY (Ticket_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 56,
AVG_ROW_LENGTH = 8192,
CHARACTER SET utf8,
COLLATE utf8_general_ci,
COMMENT = 'Хранение тикета на ремонт';

--
-- Create foreign key
--
ALTER TABLE ticket 
  ADD CONSTRAINT FK_ticket_Department_id FOREIGN KEY (Department_id)
    REFERENCES department(department_id) ON DELETE SET NULL;

--
-- Create foreign key
--
ALTER TABLE ticket 
  ADD CONSTRAINT FK_ticket_Master_id FOREIGN KEY (Master_id)
    REFERENCES master(master_id) ON DELETE SET NULL;

--
-- Create foreign key
--
ALTER TABLE ticket 
  ADD CONSTRAINT FK_ticket_Tech_type_id FOREIGN KEY (Tech_type_id)
    REFERENCES tech_type(tech_type_id) ON DELETE SET NULL;

--
-- Create foreign key
--
ALTER TABLE ticket 
  ADD CONSTRAINT FK_ticket_Ticket_type_id FOREIGN KEY (Ticket_type_id)
    REFERENCES ticket_type(ticket_type_id) ON DELETE SET NULL;

--
-- Create table `ticket_state`
--
CREATE TABLE ticket_state (
  ticket_state_id BIGINT(20) NOT NULL AUTO_INCREMENT,
  ticket_state VARCHAR(255) NOT NULL,
  PRIMARY KEY (ticket_state_id)
)
ENGINE = INNODB,
AUTO_INCREMENT = 6,
AVG_ROW_LENGTH = 3276,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create table `ticket_history`
--
CREATE TABLE ticket_history (
  ticket_id BIGINT(20) NOT NULL,
  state BIGINT(20) DEFAULT NULL,
  worker_id BIGINT(20) DEFAULT NULL,
  handout_date DATETIME DEFAULT NULL,
  handout_owner VARCHAR(255) DEFAULT NULL,
  handout_owner_phone VARCHAR(255) DEFAULT NULL,
  handout_department_id BIGINT(20) DEFAULT NULL,
  final_comment VARCHAR(255) DEFAULT NULL,
  PRIMARY KEY (ticket_id)
)
ENGINE = INNODB,
AVG_ROW_LENGTH = 712,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create foreign key
--
ALTER TABLE ticket_history 
  ADD CONSTRAINT FK_ticket_history_handout_department_id FOREIGN KEY (handout_department_id)
    REFERENCES department(department_id) ON DELETE SET NULL;

--
-- Create foreign key
--
ALTER TABLE ticket_history 
  ADD CONSTRAINT FK_ticket_history_master_id FOREIGN KEY (worker_id)
    REFERENCES master(master_id) ON DELETE SET NULL;

--
-- Create foreign key
--
ALTER TABLE ticket_history 
  ADD CONSTRAINT FK_ticket_history_state FOREIGN KEY (state)
    REFERENCES ticket_state(ticket_state_id) ON DELETE SET NULL ON UPDATE CASCADE;

--
-- Create foreign key
--
ALTER TABLE ticket_history 
  ADD CONSTRAINT FK_ticket_history_ticket_id FOREIGN KEY (ticket_id)
    REFERENCES ticket(Ticket_id) ON DELETE CASCADE;

--
-- Create table `ticket_pool_states`
--
CREATE TABLE ticket_pool_states (
  ticket_id BIGINT(20) NOT NULL,
  prev_state BIGINT(20) DEFAULT NULL,
  PRIMARY KEY (ticket_id)
)
ENGINE = INNODB,
CHARACTER SET utf8,
COLLATE utf8_general_ci;

--
-- Create foreign key
--
ALTER TABLE ticket_pool_states 
  ADD CONSTRAINT FK_ticket_pool_states_prev_state FOREIGN KEY (prev_state)
    REFERENCES ticket_state(ticket_state_id) ON DELETE SET NULL;

--
-- Create foreign key
--
ALTER TABLE ticket_pool_states 
  ADD CONSTRAINT FK_ticket_pool_states_ticket_id FOREIGN KEY (ticket_id)
    REFERENCES ticket_history(ticket_id) ON DELETE CASCADE;

-- 
-- Dumping data for table role
--
INSERT INTO role VALUES
(0, 'ADMIN'),
(1, 'Master');

-- 
-- Dumping data for table ticket_type
--
INSERT INTO ticket_type VALUES
(7, 'Ремонт');

-- 
-- Dumping data for table tech_type
--
INSERT INTO tech_type VALUES
(7, 'Ноутбук'),
(8, 'Персональный компьютер'),
(10, 'Мышка'),
(12, 'Клавиатура');

-- 
-- Dumping data for table master
--
INSERT INTO master VALUES
(0, 0, 'admin', 'admin', 'TestAdmin', 'TestAdmin', NULL),
(1, 1, 'Master_1', 'test', 'TestMaster_1', 'TestMaster_1', NULL),
(2, 1, 'Master_2', 'test', 'TestMaster_2', 'TestMaster_2', NULL),
(3, 1, 'PavPar', '123123', 'Павел', 'Парамонов', 'Александрович'),
(4, 1, 'Master_3', '123123', 'Иван', 'Иванов', ''),
(5, 1, 'lazzyDude', 'idk', 'Лентяй', 'Лентяев', '');

-- 
-- Dumping data for table department
--
INSERT INTO department VALUES
(5, 'Отдел по ремонту компьютеров '),
(6, 'Отдел по сварке №1'),
(7, 'Бух. отдел №1'),
(8, 'Отдел безопасности №3'),
(9, 'Отдел обеспечения');

-- 
-- Dumping data for table ticket
--
INSERT INTO ticket VALUES
(33, '2020-05-19 14:34:37', 'PavPar', '123123', 1, 7, 'PC_1', 7, 5, '1'),
(34, '2020-05-19 14:35:39', 'PavPar', '123123', 1, 7, '2', 8, 7, '124124'),
(35, '2020-05-19 15:57:51', 'PavPar', '123123', 1, 7, 'PC_1', 8, 6, '121'),
(36, '2020-05-19 23:31:16', 'Update test', '', 1, 7, '', 7, 5, ''),
(37, '2020-05-19 23:32:51', '12412', '124124', 1, 7, '', 7, 5, ''),
(38, '2020-05-20 01:15:54', 'PavPar', '123123', 2, 7, 'PC_2', 7, 7, '124124124'),
(39, '2020-05-20 07:52:51', 'PavPar', '123123', 1, 7, 'PC_1', 8, 7, 'r1251'),
(40, '2020-05-27 02:02:31', '24124124', '12313', 1, 7, '1', 7, 5, ''),
(41, '2020-05-27 02:02:44', '1', '1', 1, 7, '1', 7, 5, '1'),
(42, '2020-05-27 04:22:55', 'PavPar', '123', 3, 7, '123', 7, 5, '123'),
(43, '2020-05-27 14:33:15', 'Смит ', '73811515', 1, 7, 'PC-11', 8, 8, 'testValue'),
(44, '2020-05-28 08:24:18', 'Анатолий Геннадьевич', '123123', 4, 7, 'PC-11', 8, 8, 'Сломался Windows'),
(45, '2020-05-29 16:52:02', '1', '111', 5, 7, '1', 7, 5, '124214'),
(46, '2020-05-29 16:52:11', '124214', '1212', 5, 7, '1221', 7, 5, '21412421'),
(47, '2020-05-29 16:52:21', '21414124', '214124214', 5, 7, '21412414', 7, 6, '21412421'),
(48, '2020-05-29 18:09:55', '124124', '214124', NULL, 7, '124124', 7, 5, ''),
(49, '2020-05-29 18:10:25', '15', '13531535', NULL, 7, '135235', 7, 5, '135'),
(50, '2020-05-29 18:10:35', '13535', '31535', NULL, 7, '35135', 7, 5, '15'),
(51, '2020-05-29 18:27:29', '124214124', '4214124', 1, 7, '24', 7, 5, '1241'),
(52, '2020-05-29 20:25:44', '124214124', '12', NULL, 7, '213', 7, 5, '124124'),
(53, '2020-05-29 20:25:55', '24124124', '124124', NULL, 7, '4124214', 7, 5, '12412'),
(54, '2020-05-29 20:26:06', '1412421421', '214124214', NULL, 7, '24214124', 7, 5, '1241241'),
(55, '2020-06-11 02:55:52', 'Потников Иван Сергеевич', '123123', NULL, 7, 'МЫШЬЧ', 10, NULL, 'Проверка что произойдет при удалении значения отдела и т.д');

-- 
-- Dumping data for table ticket_state
--
INSERT INTO ticket_state VALUES
(1, 'pool'),
(2, 'in process'),
(3, 'finished'),
(4, 'closed'),
(5, 'canceled');

-- 
-- Dumping data for table ticket_history
--
INSERT INTO ticket_history VALUES
(33, 4, 1, '2020-05-27 02:57:29', 'Fina;', '124214', 7, '1'),
(34, 2, 1, NULL, NULL, NULL, NULL, NULL),
(35, 4, 1, NULL, NULL, NULL, NULL, '.'),
(36, 4, 1, '2020-05-29 21:01:27', '111', '111', 5, '12.'),
(37, 4, 1, '2020-05-20 07:30:22', 'Master-2', '14124214124', 5, ''),
(38, 3, 2, '2020-05-20 01:16:14', 'PavPar', '14124214124', 5, 'Надоел'),
(39, 4, 1, '2020-05-20 07:53:36', 'PavPar', '14124214124', 8, 'hEI'),
(40, 4, 1, '2020-05-28 08:04:52', '1535', '31535', 5, '124124'),
(41, 4, 1, '2020-05-28 19:55:53', 'Courier 6', '123123', 6, 'Проверка данных тикета.'),
(42, 4, 3, NULL, NULL, NULL, NULL, 'Все починили.'),
(43, 2, 1, NULL, NULL, NULL, NULL, NULL),
(44, 4, 4, '2020-05-28 08:25:03', 'Courier_1', '123123', 6, 'Переустановил windows.'),
(45, 4, 1, '2020-05-29 21:01:20', '111', '11', 5, '1.'),
(46, 4, 1, '2020-05-29 21:01:48', '1111', '111', 5, '111.'),
(47, 4, 1, '2020-05-29 20:43:05', '12', '12', 5, '4.'),
(48, 4, 1, '2020-05-29 21:01:56', '111', '11111', 5, '1111.'),
(49, 3, 1, NULL, NULL, NULL, NULL, '111.'),
(50, 2, 1, NULL, NULL, NULL, NULL, NULL),
(51, 3, 1, NULL, NULL, NULL, NULL, '1.'),
(52, 2, 1, '2020-05-29 20:35:20', '11', '111', 5, '1.'),
(53, 3, 1, NULL, NULL, NULL, NULL, '2.'),
(54, 4, 1, '2020-05-29 20:53:16', '12', '`2', 5, '1.'),
(55, 4, 1, '2020-06-11 03:43:05', 'Я', '123', 8, 'Ошибка исправлена.');

-- 
-- Dumping data for table ticket_pool_states
--
INSERT INTO ticket_pool_states VALUES
(49, 3),
(53, 3),
(54, 3),
(36, 4),
(45, 4),
(46, 4),
(47, 4),
(48, 4),
(52, 4),
(55, 4);

-- 
-- Restore previous SQL mode
-- 
/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;

-- 
-- Enable foreign keys
-- 
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;